{% load static %}
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Exclusive Pro{% endblock %}</title>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        gold: '#d4af37',
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #050505;
            color: white;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 10px;
        }

        .animate-fade-in {
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="selection:bg-gold/30">

    <!-- Navbar -->
    <nav id="navbar" class="fixed w-full z-50 transition-all duration-500 py-6">
        <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
            <a href="{% url 'home' %}" class="text-2xl font-bold tracking-[0.3em] font-serif text-gold no-underline">
                EXCLUSIVE <span className="text-white font-sans font-light">PRO</span>
            </a>

            <div class="hidden md:flex space-x-10 text-[10px] font-bold uppercase tracking-[0.2em]">
                <a href="{% url 'home' %}"
                    class="text-gray-300 hover:text-gold transition-colors no-underline">Inicio</a>
                <a href="{% url 'acompañantes' %}"
                    class="text-gray-300 hover:text-gold transition-colors no-underline">Acompañantes</a>
                <a href="{% url 'instalaciones' %}"
                    class="text-gray-300 hover:text-gold transition-colors no-underline">Club Privado</a>
                <a href="#" class="text-gray-300 hover:text-gold transition-colors no-underline">Membresía</a>
                <a href="{% url 'contacto' %}"
                    class="text-gray-300 hover:text-gold transition-colors no-underline">Contacto</a>

                <span class="text-gray-700">|</span>

                <div class="flex space-x-2">
                    <a href="#" class="text-gold hover:text-white transition-colors no-underline">ES</a>
                    <span class="text-gray-600">/</span>
                    <a href="#" class="text-gray-500 hover:text-gold transition-colors no-underline">EN</a>
                </div>
            </div>

            <button class="md:hidden text-white">
                <i data-lucide="menu"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-black py-20 px-6 border-t border-gold/20">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-12">
            <div class="md:col-span-2 space-y-6">
                <div class="text-3xl font-bold tracking-[0.3em] font-serif text-gold">
                    EXCLUSIVE <span class="text-white font-sans font-light">PRO</span>
                </div>
                <p class="text-gray-500 text-sm font-light max-w-sm leading-loose uppercase tracking-widest">
                    La agencia boutique líder en Cali, ofreciendo servicios de acompañamiento premium con la mayor
                    discreción del mercado.
                </p>
                <div class="flex space-x-4">
                    <a href="#" class="p-3 bg-white/5 rounded-full hover:bg-gold hover:text-black transition-all"><i
                            data-lucide="message-circle" width="20"></i></a>
                    <a href="#" class="p-3 bg-white/5 rounded-full hover:bg-gold hover:text-black transition-all"><i
                            data-lucide="phone" width="20"></i></a>
                </div>
            </div>

            <div class="space-y-6">
                <h5 class="text-gold font-bold text-xs uppercase tracking-[0.2em] border-b border-gold/20 pb-2">
                    Navegación</h5>
                <ul class="space-y-4 text-xs font-bold text-gray-400 uppercase tracking-widest list-none ps-0">
                    <li><a href="{% url 'home' %}" class="hover:text-white transition-colors no-underline">Inicio</a>
                    </li>
                    <li><a href="{% url 'acompañantes' %}"
                            class="hover:text-white transition-colors no-underline">Acompañantes</a></li>
                    <li><a href="{% url 'instalaciones' %}"
                            class="hover:text-white transition-colors no-underline">Instalaciones</a></li>
                    <li><a href="{% url 'contacto' %}"
                            class="hover:text-white transition-colors no-underline">Contacto</a></li>
                </ul>
            </div>

            <div class="space-y-6">
                <h5 class="text-gold font-bold text-xs uppercase tracking-[0.2em] border-b border-gold/20 pb-2">Reservas
                </h5>
                <div class="space-y-2">
                    <p class="text-xs text-gray-400 uppercase tracking-widest">Central de Citas</p>
                    <a href="https://wa.me/{{ agencia.whatsapp_central }}"
                        class="text-2xl font-bold text-white hover:text-gold transition-colors tracking-tighter no-underline">
                        WhatsApp VIP
                    </a>
                    <p class="text-[10px] text-gray-600 mt-4 italic">Solo para mayores de 18 años.</p>
                </div>
            </div>
        </div>
        <div class="max-w-7xl mx-auto mt-20 pt-10 border-t border-white/5 text-center">
            <p class="text-[10px] text-gray-700 tracking-[0.5em] uppercase font-bold">
                &copy; 2026 Exclusive Pro Luxury Agency • Cali • Colombia
            </p>
        </div>
    </footer>

    <!-- Global Floating WhatsApp -->
    {% if agencia.whatsapp_central %}
    <a href="https://wa.me/{{ agencia.whatsapp_central }}?text=Hola,%20quisiera%20más%20información" target="_blank"
        class="fixed bottom-6 right-6 z-50 bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-lg shadow-green-500/20 transition-all hover:-translate-y-1 hover:scale-110 flex items-center justify-center group no-underline">
        <i data-lucide="message-circle" class="w-8 h-8 fill-current"></i>
        <!-- Tooltip -->
        <span
            class="absolute right-full mr-4 bg-black/90 text-white text-xs px-3 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity border border-white/10">
            Reserva Rápida
        </span>
    </a>
    {% endif %}

    <!-- Age Verification Modal -->
    <div id="age-modal"
        class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4 backdrop-blur-md hidden">
        <div
            class="bg-[#0a0a0a] border border-gold/30 p-10 max-w-md w-full text-center relative overflow-hidden shadow-2xl shadow-gold/10">
            <!-- Decorative Elements -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-gold to-transparent">
            </div>

            <div class="mb-8 relative z-10">
                <div class="inline-block border-2 border-gold rounded-full p-4 mb-4">
                    <span class="text-3xl font-black text-gold">18+</span>
                </div>
                <h2 class="text-3xl font-serif text-white mb-2">Contenido Exclusivo</h2>
                <p class="text-gray-400 text-sm font-light uppercase tracking-widest">Acceso Restringido</p>
            </div>

            <div class="space-y-6 relative z-10">
                <p class="text-gray-500 text-sm leading-relaxed">
                    Este sitio web contiene material destinado exclusivamente a adultos.
                    Al ingresar, confirmas que tienes al menos 18 años de edad o la mayoría de edad legal en tu
                    jurisdicción.
                </p>

                <div class="flex flex-col gap-3">
                    <button onclick="verifyAge()"
                        class="w-full py-3 bg-gold text-black font-bold uppercase tracking-[0.2em] hover:bg-[#b8962d] transition-colors">
                        Soy mayor de 18 años
                    </button>
                    <a href="https://google.com"
                        class="w-full py-3 border border-white/10 text-gray-500 text-xs font-bold uppercase tracking-[0.2em] hover:text-white hover:border-white/30 transition-colors no-underline">
                        Salir del sitio
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Init Icons & Scroll Effect -->
    <script>
        lucide.createIcons();

        // Navbar Scroll Effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) {
                nav.classList.add('bg-black/90', 'py-3', 'border-b', 'border-yellow-600/30');
                nav.classList.remove('py-6');
            } else {
                nav.classList.remove('bg-black/90', 'py-3', 'border-b', 'border-yellow-600/30');
                nav.classList.add('py-6');
            }
        });

        // Age Verification Logic
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('ageVerified')) {
                document.getElementById('age-modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent scrolling
            }
        });

        function verifyAge() {
            localStorage.setItem('ageVerified', 'true');
            const modal = document.getElementById('age-modal');
            modal.style.opacity = '0';
            modal.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto'; // Restore scrolling
            }, 500);
        }
    </script>
    <!-- Global Floating Action Buttons (Moved from home.html) -->
    <div class="fixed right-0 top-1/2 -translate-y-1/2 z-[60] flex flex-col items-end">
        <button onclick="toggleSidePanel('live')"
            class="bg-red-700 hover:bg-red-800 text-white p-4 flex flex-col items-center justify-center gap-2 rounded-l-xl shadow-2xl transition-all hover:pr-8 group mb-2">
            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
            <span class="[writing-mode:vertical-lr] rotate-180 text-[9px] font-black tracking-[0.3em] uppercase">En
                Vivo</span>
        </button>
        <button onclick="toggleSidePanel('rates')"
            class="bg-gold hover:bg-[#b8962d] text-black p-4 flex flex-col items-center justify-center gap-2 rounded-l-xl shadow-2xl transition-all hover:pr-8 group">
            <i data-lucide="dollar-sign" class="w-4"></i>
            <span
                class="[writing-mode:vertical-lr] rotate-180 text-[9px] font-black tracking-[0.3em] uppercase">Tarifas</span>
        </button>
    </div>

    <!-- Side Panels -->
    <!-- LIVE PANEL -->
    <div id="panel-live" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleSidePanel('live')"></div>
        <div
            class="absolute top-0 right-0 h-full w-full sm:w-[400px] bg-[#0a0a0a] border-l border-gold/20 shadow-2xl overflow-y-auto custom-scrollbar">
            <div class="p-8">
                <div class="flex justify-between items-center mb-10">
                    <h3 class="text-2xl font-serif text-gold">En Tiempo Real</h3>
                    <button onclick="toggleSidePanel('live')" class="text-gray-400 hover:text-white"><i
                            data-lucide="x"></i></button>
                </div>

                <div class="space-y-8">
                    <p class="text-[10px] text-gray-500 uppercase tracking-[0.2em] font-bold">Estado Actual de Modelos
                    </p>

                    <!-- GOLD LIST -->
                    {% if en_linea_gold %}
                    <div>
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-[10px] font-black text-gold tracking-[0.4em] uppercase">GOLD</h4>
                            <div class="h-[1px] flex-grow bg-gold/20 ml-4"></div>
                        </div>
                        <div class="space-y-6">
                            {% for p in en_linea_gold %}
                            <div class="flex items-center space-x-6 border-b border-white/5 pb-6">
                                <div class="relative">
                                    <img src="{{ p.foto_principal.url }}"
                                        class="w-16 h-16 rounded-full object-cover grayscale transition-all border border-white/10" />
                                    <div id="status-dot-{{ p.id }}"
                                        class="absolute -bottom-1 -right-1 w-4 h-4 border-2 border-[#0a0a0a] rounded-full {% if p.estado == 'DISPONIBLE' %}bg-green-500{% elif p.estado == 'OCUPADA' %}bg-red-500{% else %}bg-yellow-500{% endif %}">
                                    </div>
                                </div>
                                <div class="flex-grow">
                                    <h4 class="font-serif text-lg text-white">{{ p.nombre }}</h4>
                                    <div class="flex items-center space-x-2 mt-1">
                                        <span class="text-[8px] text-gold font-black tracking-widest uppercase">{{
                                            p.tarifa.nombre }}</span>
                                        <span id="status-text-{{ p.id }}"
                                            class="text-[9px] font-bold px-2 py-0.5 rounded-sm uppercase tracking-wider
                                            {% if p.estado == 'DISPONIBLE' %}text-green-500 bg-green-900/20{% elif p.estado == 'OCUPADA' %}text-red-500 bg-red-900/20{% else %}text-yellow-500 bg-yellow-900/20{% endif %}">
                                            {{ p.get_estado_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- PLATINUM LIST -->
                    {% if en_linea_platinum %}
                    <div>
                        <div class="flex items-center justify-between mb-6">
                            <h4 class="text-[10px] font-black text-gold tracking-[0.4em] uppercase">PLATINUM</h4>
                            <div class="h-[1px] flex-grow bg-gold/20 ml-4"></div>
                        </div>
                        <div class="space-y-6">
                            {% for p in en_linea_platinum %}
                            <div class="flex items-center space-x-6 border-b border-white/5 pb-6">
                                <div class="relative">
                                    <img src="{{ p.foto_principal.url }}"
                                        class="w-16 h-16 rounded-full object-cover grayscale transition-all border border-white/10" />
                                    <div id="status-dot-{{ p.id }}"
                                        class="absolute -bottom-1 -right-1 w-4 h-4 border-2 border-[#0a0a0a] rounded-full {% if p.estado == 'DISPONIBLE' %}bg-green-500{% elif p.estado == 'OCUPADA' %}bg-red-500{% else %}bg-yellow-500{% endif %}">
                                    </div>
                                </div>
                                <div class="flex-grow">
                                    <h4 class="font-serif text-lg text-white">{{ p.nombre }}</h4>
                                    <div class="flex items-center space-x-2 mt-1">
                                        <span class="text-[8px] text-gold font-black tracking-widest uppercase">{{
                                            p.tarifa.nombre }}</span>
                                        <span id="status-text-{{ p.id }}"
                                            class="text-[9px] font-bold px-2 py-0.5 rounded-sm uppercase tracking-wider
                                            {% if p.estado == 'DISPONIBLE' %}text-green-500 bg-green-900/20{% elif p.estado == 'OCUPADA' %}text-red-500 bg-red-900/20{% else %}text-yellow-500 bg-yellow-900/20{% endif %}">
                                            {{ p.get_estado_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- RATES PANEL (Calculator) -->
    <div id="panel-rates" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleSidePanel('rates')"></div>
        <div
            class="absolute top-0 right-0 h-full w-full sm:w-[400px] bg-[#0a0a0a] border-l border-gold/20 shadow-2xl overflow-y-auto custom-scrollbar">
            <div class="p-8">
                <div class="flex justify-between items-center mb-10">
                    <h3 class="text-2xl font-serif text-gold">Calculadora VIP</h3>
                    <button onclick="toggleSidePanel('rates')" class="text-gray-400 hover:text-white"><i
                            data-lucide="x"></i></button>
                </div>

                <!-- Calculator Form -->
                <div class="bg-[#111] p-6 rounded-sm border border-white/5 space-y-6">
                    <!-- Categoría -->
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Categoría</label>
                        <select id="calc-category" onchange="calculateRate()"
                            class="w-full bg-black border border-white/10 text-white p-3 text-sm focus:border-gold outline-none rounded-sm">
                            <option value="GOLD" data-price-1h="{{ tarifas_gold.precio_hora }}"
                                data-price-30="{{ tarifas_gold.precio_30_min }}">GOLD</option>
                            <option value="PLATINUM" data-price-1h="{{ tarifas_platinum.precio_hora }}"
                                data-price-30="{{ tarifas_platinum.precio_30_min }}">PLATINUM</option>
                        </select>
                    </div>

                    <!-- Tiempo -->
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Duración</label>
                        <select id="calc-duration" onchange="calculateRate()"
                            class="w-full bg-black border border-white/10 text-white p-3 text-sm focus:border-gold outline-none rounded-sm">
                            <option value="60">60 Minutos</option>
                            <option value="30">30 Minutos</option>
                        </select>
                    </div>

                    <!-- Servicio Adicional -->
                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Adicionales</label>
                        <select id="calc-extras" onchange="calculateRate()"
                            class="w-full bg-black border border-white/10 text-white p-3 text-sm focus:border-gold outline-none rounded-sm">
                            <option value="0">Ninguno</option>
                            <option value="JACUZZI">Suite con Jacuzzi (Incluido en Platinum)</option>
                        </select>
                    </div>

                    <!-- Resultado -->
                    <div class="mt-8 pt-8 border-t border-white/10 text-center space-y-2">
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest">Total Estimado</p>
                        <p id="calc-result" class="text-3xl font-serif text-gold font-bold transition-all duration-300">
                            $0
                            COP</p>
                        <p id="calc-usd" class="text-sm text-gray-400">$0 USD</p>
                    </div>

                    <p class="text-[9px] text-gray-600 text-center leading-relaxed mt-4">
                        * Tarifas sujetas a cambios sin previo aviso. El servicio Platinum incluye Jacuzzi sin costo
                        adicional.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Logic for Panels -->
    <script>
        // Real-Time Status Polling (Every 5 seconds)
        function checkStatus() {
            fetch('/api/status/')
                .then(response => response.json())
                .then(data => {
                    if (!data.perfiles) return;

                    data.perfiles.forEach(p => {
                        // Update dots in Live Panel
                        const dot = document.getElementById(`status-dot-${p.id}`);
                        const text = document.getElementById(`status-text-${p.id}`);

                        // Helper to set colors
                        const setStatus = (el, type) => {
                            el.className = el.className.replace(/bg-green-500|bg-red-500|bg-yellow-500|text-green-500|text-red-500|text-yellow-500|bg-green-900\/20|bg-red-900\/20|bg-yellow-900\/20/g, '');
                            if (type === 'dot') {
                                el.classList.add(
                                    p.estado === 'DISPONIBLE' ? 'bg-green-500' :
                                        p.estado === 'OCUPADA' ? 'bg-red-500' : 'bg-yellow-500',
                                    'absolute', '-bottom-1', '-right-1', 'w-4', 'h-4', 'border-2', 'border-[#0a0a0a]', 'rounded-full'
                                );
                            } else if (type === 'text') {
                                el.classList.add(
                                    p.estado === 'DISPONIBLE' ? 'text-green-500' :
                                        p.estado === 'OCUPADA' ? 'text-red-500' : 'text-yellow-500',
                                    p.estado === 'DISPONIBLE' ? 'bg-green-900/20' :
                                        p.estado === 'OCUPADA' ? 'bg-red-900/20' : 'bg-yellow-900/20',
                                    'text-[9px]', 'font-bold', 'px-2', 'py-0.5', 'rounded-sm', 'uppercase', 'tracking-wider'
                                );
                                // Update text label (Map value to Display is hard in JS without map, let's just use text for now or simple switch)
                                let display = 'Disponible';
                                if (p.estado === 'OCUPADA') display = 'Ocupada';
                                if (p.estado === 'DESCANSO') display = 'En Descanso';
                                if (p.estado === 'NO_DISPONIBLE') display = 'No Disponible';
                                el.innerText = display;
                            }
                        };

                        if (dot) setStatus(dot, 'dot');
                        if (text) setStatus(text, 'text');

                        // Update Grid Pulse if available/unavailable (Only if on Home or Grid pages)
                        const gridDot = document.getElementById(`status-dot-grid-${p.id}`);
                        if (gridDot) {
                            if (p.estado === 'DISPONIBLE') {
                                gridDot.style.display = 'flex';
                            } else {
                                gridDot.style.display = 'none';
                            }
                        }
                    });
                })
                .catch(err => console.error("Error polling status:", err));
        }

        // Start Polling
        setInterval(checkStatus, 5000);
        checkStatus(); // Initial check

        // Side Panel Logic
        function toggleSidePanel(panelName) {
            const panel = document.getElementById('panel-' + panelName);
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
            } else {
                panel.classList.add('hidden');
            }

            if (panelName === 'rates') {
                calculateRate(); // Init calculator
            }
        }

        // Rate Calculator Logic
        function calculateRate() {
            const categorySelect = document.getElementById('calc-category');
            const durationSelect = document.getElementById('calc-duration');
            const extraSelect = document.getElementById('calc-extras');

            if (!categorySelect || !durationSelect) return;

            const selectedOption = categorySelect.options[categorySelect.selectedIndex];

            let price = 0;

            if (durationSelect.value === '60') {
                price = parseFloat(selectedOption.dataset.price1h || 0);
            } else {
                price = parseFloat(selectedOption.dataset.price30 || 0);
            }

            // Extras Logic (Platinum includes Jacuzzi)
            if (extraSelect.value === 'JACUZZI' && categorySelect.value === 'GOLD') {
                price += 50000;
            }

            // Format
            const copFormatter = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
            const usdFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });

            document.getElementById('calc-result').innerText = copFormatter.format(price);
            document.getElementById('calc-usd').innerText = "Aprox " + usdFormatter.format(price / 4100);
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>